<!DOCTYPE html>
<html>
  <head>
    <title>CSA Space Apps Challenge</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      .grid-container {
        display: grid;
        grid-template-columns: auto auto;
        background-color: #2196F3;
        padding: 10px;
      }

      .grid-item {
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(0, 0, 0, 0.8);
        padding: 20px;
        font-size: 30px;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="data.js"></script>
    <script>
        function check(){
          var responseList = [];
          var today = new Date();
          var todayMonth = today.getMonth() + 1;
          var todayDay = today.getDate();
          var todayYear = today.getFullYear();
          var declination1, declination2, ascension1, ascension2, calendar, shutter, typeofimage, mode, minDec, maxDec, minRa, maxRa;
        
          declination1 = document.getElementById("declination1").value;
          declination2 = document.getElementById("declination2").value;
          ascension1 = document.getElementById("ascension1").value;
          ascension2 = document.getElementById("ascension2").value;
          calendar = document.getElementById("datepicker").value;
          shutter = document.applyChanges.shutter.value;
          typeofimage = document.applyChanges.typeofimage.value;
          mode = document.applyChanges.mode.value;
          minDec = Math.min(declination1, declination2); 
          maxDec = Math.max(declination1, declination2);
          minRa = Math.min(ascension1, ascension2);
          maxRa = Math.max(ascension1, ascension2);
          month = calendar.slice(0, 2);
          day = calendar.slice(3, 5);
          year = calendar.slice(6, 10);
          queryTime = year + '-' + month + '-' + day;
          if(minDec >= -90 && maxDec <= 90){
            if(minRa >= 0 && maxRa <= 24){
              if(parseInt(calendar.slice(0,2)) <= todayMonth && parseInt(calendar.slice(3,5)) <= todayDay && parseInt(calendar.slice(6)) <= todayYear){
              //Date is today or past
                var arrayLength = DATA.length;
                var imagesViewHtml = "";
                for (var i = 0; i < arrayLength; i++) {
                    var clean = DATA[i]['CLEAN'];
                    var objctDec = DATA[i]['OBJCTDEC'];
                    var objctRa = DATA[i]['OBJCTRA'];
                    if (clean == 1-typeofimage && objctDec >= minDec && objctDec <= maxDec){
                      if(objctRa >= minRa && objctRa <= maxRa){
                        var fileName = DATA[i]['filename'];
                        imagesViewHtml = imagesViewHtml + "<div class=\"column is-one-quarter-desktop is-half-tablet\"><div class=\"card\"><div class=\"card-image\"><figure class=\"image is-3by2\"><img src=\"Images/";
                        imagesViewHtml = imagesViewHtml + fileName;
                        imagesViewHtml = imagesViewHtml + "_rgb.jpg\" alt=\"\"></figure><div class=\"card-content is-overlay is-clipped\"><span class=\"tag is-info\">";
                        imagesViewHtml = imagesViewHtml + fileName;
                        imagesViewHtml = imagesViewHtml + "</span></div></div></div></div>";
                      }
                    }
                }
                document.getElementById("imagesView").innerHTML = imagesViewHtml;
              }
              else{
                alert("Please enter a value that is not in the future.");
              }
            }
            else{
              alert("Please enter values between 0 and 24.");
            }
          }
          else{
            alert("Please enter values between -90 and 90.");
          }
        }
      </script>
      <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
      <link rel="stylesheet" href="/resources/demos/style.css">
      <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
      <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <script>
        $(function() {
          $( "#datepicker" ).datepicker();
        } );
      </script>
       <link rel="stylesheet" type="text/css" href="main.css">
    </head>
    <body>
        <form name="applyChanges">
        <fieldset>
          <p class="panel-heading">
            <center><font color="#3377ff" size="+4"> NEOSSAT Data </font></center>
          </p>
          <div class="grid-container">
            <div class="grid-item">
              <a>
                        <p>&nbsp; &nbsp; Declination: </p> &nbsp; &nbsp; between: <input type="text" id="declination1" size="20" name="declination1">
                          &nbsp; and: <input type="text" id="declination2" size="20" name="declination2">
              </a>
              <a>
               <p>&nbsp; &nbsp; Ascension: </p> &nbsp; &nbsp; between: <input type="text" id="ascension1" size="20" name="ascension1">
                          &nbsp; and: <input type="text" id="ascension2" size="20" name="ascension2">
              </a>
              <a>
                <p>&nbsp; &nbsp; Shutter: &nbsp;
                          <input type="radio" name="shutter" value="1"
                             checked>
                          <label for="open">Open &nbsp;</label>

                          <input type="radio" name="shutter" value="2">
                          <label for="close">Close</label>
                        </p>
              </a>
              <a>
               <p>&nbsp; &nbsp; Mode: &nbsp;
                          <input type="radio" name="mode" value="1"
                             checked>
                          <label for="five-point">Five-Point &nbsp;</label>

                          <input type="radio" name="mode" value="2">
                          <label for="slew">Slew</label>
                        </p>
                        
              </a>
              <a>
               <p>&nbsp; &nbsp; Type of Image: &nbsp;
                          <input type="radio" name="typeofimage" value=0
                             checked>
                          <label for="clean">Clean &nbsp;</label>
                            
                          <input type="radio" name="typeofimage" value=1>
                          <label for="raw">Raw</label>
                        </p>
              </a>
              <a>
               <p>&nbsp; &nbsp; Date: <input type="text" id="datepicker"></p>
              </a>

            </div>
            <div class="grid-item">
              /api/v3/image/:image_id;
            </div>
          </fieldset>
        </form>
        <div class="panel-block">
          <button class="button is-link is-outlined is-fullwidth" type="button" onclick="check()">
            Apply filters
          </button>
      </div>

      <div class="columns is-multiline" id = "imagesView"></div>
      </div>  
        </body>
</html>
